# Portworx on IBM Cloud (Gitops) module

Module to populate a gitops repository with the resources required to provision Portworx in an OpenShift cluster


## Software dependencies

The module depends on the following software components:

### Terraform version

- \>= v0.15

### Terraform providers


- gitops (cloud-native-toolkit/gitops)

### Module dependencies


- gitops - [github.com/cloud-native-toolkit/terraform-tools-gitops.git](https://github.com/cloud-native-toolkit/terraform-tools-gitops.git) (>= 1.1.0)
- ibmcloud-operator - [github.com/cloud-native-toolkit/terraform-gitops-ibmcloud-operator.git](https://github.com/cloud-native-toolkit/terraform-gitops-ibmcloud-operator.git) (>= 0.1.0)
- resource-group - [github.com/cloud-native-toolkit/terraform-ibm-resource-group.git](https://github.com/cloud-native-toolkit/terraform-ibm-resource-group.git) (>= 0.1.0)

## Example usage

```hcl
module "gitops-ibm-portworx" {
  source = "github.com/cloud-native-toolkit/terraform-gitops-ibm-portworx"

  capacity = var.gitops-ibm-portworx_capacity
  default_block_storage_class = var.gitops-ibm-portworx_default_block_storage_class
  default_file_storage_class = var.gitops-ibm-portworx_default_file_storage_class
  default_rwo_storage_class = var.gitops-ibm-portworx_default_rwo_storage_class
  default_rwx_storage_class = var.gitops-ibm-portworx_default_rwx_storage_class
  encryption_key = var.gitops-ibm-portworx_encryption_key
  git_credentials = module.gitops_repo.git_credentials
  gitops_config = module.gitops_repo.gitops_config
  ibmcloud_api_key = var.ibmcloud_api_key
  iops = var.gitops-ibm-portworx_iops
  kubeseal_cert = module.gitops_repo.sealed_secrets_cert
  profile = var.gitops-ibm-portworx_profile
  region = var.region
  resource_group_id = module.resource_group.id
  server_name = module.gitops_repo.server_name
}

```

## Module details

### Inputs

| Name | Description | Required | Default | Source |
|------|-------------|---------|----------|--------|
| gitops_config | Config information regarding the gitops repo structure | true |  | gitops.gitops_config |
| git_credentials | The credentials for the gitops repo(s) | true |  | gitops.git_credentials |
| kubeseal_cert | The certificate/public key used to encrypt the sealed secrets | true |  | gitops.sealed_secrets_cert |
| server_name | The name of the server | false | default | gitops.server_name |
| resource_group_id | The id of the resource group where the portworx instance will be provisioned | true |  | resource-group.id |
| ibmcloud_api_key | The api key for the IBM Cloud account | true |  |  |
| region | The region where the Portworx service should be deployed. This region used doesn't really impact anything because the service runs in the cluster | false | us-east |  |
| encryption_key | The crn for the encryption key that should be used to encrypt the volume. If not provided the volume will be encrypted with an IBM-managed key | true |  |  |
| capacity | The capacity of the portworx volume | false | 200 |  |
| iops | The transfer speed of the portworx volume. This value is only used if the profile is set to 'custom' | true |  |  |
| profile | The profile of the portworx volumes | false | 10iops-tier |  |
| default_rwx_storage_class | The default storage class that should be used for RWX volumes | false | portworx-rwx-gp3-sc |  |
| default_rwo_storage_class | The default storage class that should be used for RWO volumes | false | portworx-gp3-sc |  |
| default_file_storage_class | The default storage class that should be used for file volumes | false | portworx-gp3-sc |  |
| default_block_storage_class | The default storage class that should be used for block volumes | false | ibmc-vpc-block-10iops-tier |  |

### Outputs

| Name | Description |
|------|-------------|
| name | The name of the module |
| branch | The branch where the module config has been placed |
| namespace | The namespace where the module will be deployed |
| server_name | The server where the module will be deployed |
| layer | The layer where the module is deployed |
| type | The type of module where the module is deployed |
| region | The region where the portworx resource has been delivered |
| resource_group_id | The id of the resource group where the portworx resource has been delivered |
| rwx_storage_class |  |
| rwo_storage_class |  |
| file_storage_class |  |
| block_storage_class |  |
| storage_classes_provided |  |

## Resources

- [Documentation](https://operate.cloudnativetoolkit.dev)
- [Module catalog](https://modules.cloudnativetoolkit.dev)

> License: Apache License 2.0 | Generated by iascable (3.2.2)
